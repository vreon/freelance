[gd_scene load_steps=16 format=2]

[ext_resource path="res://levels/GrasslandTest.gd" type="Script" id=1]
[ext_resource path="res://tilesets/grassland/grassland.tres" type="TileSet" id=2]
[ext_resource path="res://utilities/Door.tscn" type="PackedScene" id=3]
[ext_resource path="res://Lance.tscn" type="PackedScene" id=4]
[ext_resource path="res://ui/GUI.tscn" type="PackedScene" id=5]
[ext_resource path="res://utilities/AutoCameraBounds.gd" type="Script" id=6]
[ext_resource path="res://backgrounds/bg.png" type="Texture" id=7]
[ext_resource path="res://enemies/Tilter.tscn" type="PackedScene" id=8]
[ext_resource path="res://sprites/scuba.png" type="Texture" id=9]
[ext_resource path="res://levels/Water.gd" type="Script" id=10]
[ext_resource path="res://sprites/noise.png" type="Texture" id=11]

[sub_resource type="RectangleShape2D" id=1]

extents = Vector2( 88, 8 )

[sub_resource type="Shader" id=2]

code = "shader_type canvas_item;

uniform vec4 water_color : hint_color;
uniform vec4 surface_color : hint_color;
uniform sampler2D distortion_texture;
uniform float height;

void fragment() {
	float surface_factor = step(UV.y * height, 3);
	
	vec4 d = texture(distortion_texture, UV * 0.5 - TIME * 0.02);
	vec2 uv = vec2(SCREEN_UV.x, SCREEN_UV.y - (d.r * 0.03));
	
	vec4 c = texture(SCREEN_TEXTURE, uv);
	c = mix(c, water_color, 0.5);
	c = mix(vec4(vec3(0.5), 1.0), c, 1.4);
	
	c *= mix(c, surface_color, surface_factor);
	
	COLOR = c;
}"

[sub_resource type="ShaderMaterial" id=3]

shader = SubResource( 2 )
shader_param/water_color = Color( 0.0431373, 0.756863, 0.811765, 1 )
shader_param/surface_color = Color( 1, 1, 1, 1 )
shader_param/height = 80.0
shader_param/distortion_texture = ExtResource( 11 )

[sub_resource type="RectangleShape2D" id=4]

extents = Vector2( 72, 40 )

[node name="GrasslandTest" type="Node2D"]
script = ExtResource( 1 )

[node name="TileMap" type="TileMap" parent="."]
tile_set = ExtResource( 2 )
cell_size = Vector2( 16, 16 )
format = 1
tile_data = PoolIntArray( -1, 0, 196611, -65536, 0, 196611, -65535, 0, 196609, -65534, 0, 196609, -65533, 0, 196609, -65532, 0, 196609, -65531, 0, 196609, -65530, 0, 196609, -65529, 0, 196609, -65528, 0, 196609, -65527, 0, 196609, -65526, 0, 196609, -65525, 0, 196609, -65524, 0, 196609, -65523, 0, 196609, -65522, 0, 196609, -65521, 0, 196609, -65520, 0, 196609, -65519, 0, 196609, -65518, 0, 196609, -65517, 0, 196609, -65516, 0, 196609, -65515, 0, 196609, -65514, 0, 196609, -65513, 0, 196609, -65512, 0, 196609, -65511, 0, 196609, -65510, 0, 196609, -65509, 0, 196609, -65508, 0, 196609, -65507, 0, 196609, -65506, 0, 196609, -65505, 0, 196609, -65504, 0, 196609, -65503, 0, 196609, -65502, 0, 196609, -65501, 0, 196609, -65500, 0, 196609, -65499, 0, 196609, -65498, 0, 196609, -65497, 0, 196609, -65496, 0, 196609, -65495, 0, 196609, -65494, 0, 196609, -65493, 0, 196609, -65492, 0, 196609, -65491, 0, 196609, -65490, 0, 196609, -65489, 0, 196609, -65488, 0, 196609, -65487, 0, 196609, -65486, 0, 196609, -65485, 0, 196609, -65484, 0, 196609, -65483, 0, 196609, -65482, 0, 196609, -65481, 0, 196609, -65480, 0, 196609, -65479, 0, 196609, -65478, 0, 196609, -65477, 0, 196609, -65476, 0, 196609, -65475, 0, 196609, -65474, 0, 196609, -65473, 0, 196609, -65472, 0, 196609, -65471, 0, 196609, -65470, 0, 196609, -65469, 0, 196609, -65468, 0, 196609, -65467, 0, 196609, -65466, 0, 196609, -65465, 0, 196609, -65464, 0, 196611, -65463, 0, 1, -65462, 0, 1, -65461, 0, 1, -65460, 0, 1, -65459, 0, 1, -65458, 0, 1, -65457, 0, 2, 65535, 0, 196611, 72, 0, 65536, 73, 0, 65537, 74, 0, 65537, 75, 0, 65537, 76, 0, 65537, 77, 0, 65537, 78, 0, 65537, 79, 0, 65538, 131071, 0, 65539, 65589, 1, 0, 65590, 1, 0, 65603, 1, 0, 65604, 1, 0, 65605, 1, 0, 65608, 0, 65536, 65609, 0, 65537, 65610, 0, 65537, 65611, 0, 65537, 65612, 0, 65537, 65613, 0, 65537, 65614, 0, 65537, 65615, 0, 65538, 196607, 0, 65539, 131125, 0, 196608, 131126, 0, 196610, 131139, 0, 196608, 131140, 0, 1, 131141, 0, 196610, 131144, 0, 65536, 131145, 0, 65537, 131146, 0, 65537, 131147, 0, 65537, 131148, 0, 65537, 131149, 0, 65537, 131150, 0, 65537, 131151, 0, 65538, 262143, 0, 65539, 196651, 1, 0, 196652, 1, 0, 196653, 1, 0, 196668, 1, 0, 196669, 1, 0, 196670, 1, 0, 196676, 0, 65539, 196680, 0, 65536, 196681, 0, 65537, 196682, 0, 65537, 196683, 0, 65537, 196684, 0, 65537, 196685, 0, 65537, 196686, 0, 65537, 196687, 0, 65538, 327679, 0, 65539, 262169, 1, 0, 262170, 1, 0, 262171, 1, 0, 262172, 1, 0, 262187, 0, 196608, 262188, 0, 196609, 262189, 0, 5, 262190, 1, 0, 262191, 1, 0, 262204, 0, 196608, 262205, 0, 1, 262206, 0, 196610, 262212, 0, 131075, 262216, 0, 65536, 262217, 0, 65537, 262218, 0, 65537, 262219, 0, 65537, 262220, 0, 65537, 262221, 0, 65537, 262222, 0, 65537, 262223, 0, 65538, 393215, 0, 65539, 327705, 0, 196608, 327706, 0, 196609, 327707, 0, 196609, 327708, 0, 196610, 327725, 0, 131072, 327726, 0, 196609, 327727, 0, 196610, 327732, 1, 0, 327733, 1, 0, 327734, 1, 0, 327741, 0, 65539, 327752, 0, 65536, 327753, 0, 131073, 327754, 0, 131073, 327755, 0, 131073, 327756, 0, 131073, 327757, 0, 131073, 327758, 0, 131073, 327759, 0, 65538, 458751, 0, 65539, 393224, 0, 3, 393234, 0, 3, 393250, 1, 0, 393251, 1, 0, 393252, 1, 0, 393253, 1, 0, 393268, 0, 196608, 393269, 0, 1, 393270, 0, 196610, 393277, 0, 131075, 393288, 0, 65539, 393294, 0, 65536, 393295, 0, 65538, 524287, 0, 65539, 458760, 0, 65539, 458770, 0, 65539, 458786, 0, 196608, 458787, 0, 196609, 458788, 0, 196609, 458789, 0, 196610, 458805, 0, 65539, 458824, 0, 65539, 458830, 0, 65536, 458831, 0, 65538, 589823, 0, 65539, 524295, 2, 0, 524296, 0, 65539, 524306, 0, 65539, 524307, 1, 0, 524341, 0, 131075, 524347, 1, 0, 524348, 1, 0, 524349, 1, 0, 524360, 0, 131075, 524366, 0, 65536, 524367, 0, 65538, 655359, 0, 65539, 589830, 2, 0, 589831, 2, 0, 589832, 0, 65539, 589842, 0, 65536, 589843, 0, 2, 589883, 0, 196608, 589884, 0, 196609, 589885, 0, 196610, 589899, 1, 0, 589902, 0, 65536, 589903, 0, 65538, 720895, 0, 196611, 655360, 1, 0, 655361, 1, 0, 655362, 1, 0, 655363, 1, 0, 655364, 1, 0, 655365, 2, 0, 655366, 2, 0, 655367, 2, 0, 655368, 0, 65539, 655369, 1, 0, 655370, 1, 0, 655371, 1, 0, 655372, 1, 0, 655373, 1, 0, 655374, 1, 0, 655375, 1, 0, 655376, 1, 0, 655377, 1, 0, 655378, 0, 65536, 655379, 0, 65538, 655380, 1, 0, 655381, 1, 0, 655382, 1, 0, 655383, 1, 0, 655384, 1, 0, 655385, 1, 0, 655386, 1, 0, 655387, 1, 0, 655388, 1, 0, 655389, 1, 0, 655390, 1, 0, 655391, 2, 0, 655392, 2, 0, 655393, 2, 0, 655394, 2, 0, 655395, 2, 0, 655396, 2, 0, 655397, 2, 0, 655398, 2, 0, 655399, 2, 0, 655400, 2, 0, 655401, 2, 0, 655402, 1, 0, 655403, 1, 0, 655404, 1, 0, 655405, 1, 0, 655406, 1, 0, 655407, 1, 0, 655408, 1, 0, 655409, 1, 0, 655410, 1, 0, 655411, 1, 0, 655412, 1, 0, 655413, 1, 0, 655414, 1, 0, 655426, 1, 0, 655427, 1, 0, 655428, 1, 0, 655429, 1, 0, 655430, 1, 0, 655431, 1, 0, 655432, 1, 0, 655433, 1, 0, 655434, 2, 0, 655435, 2, 0, 655436, 2, 0, 655437, 1, 0, 655438, 0, 65536, 655439, 0, 65538, 786431, 0, 196611, 720896, 0, 1, 720897, 0, 1, 720898, 0, 1, 720899, 0, 1, 720900, 0, 1, 720901, 0, 1, 720902, 0, 1, 720903, 0, 1, 720904, 0, 65537, 720905, 0, 1, 720906, 0, 1, 720907, 0, 1, 720908, 0, 1, 720909, 0, 1, 720910, 0, 1, 720911, 0, 1, 720912, 0, 1, 720913, 0, 1, 720914, 0, 65537, 720915, 0, 65537, 720916, 0, 1, 720917, 0, 1, 720918, 0, 1, 720919, 0, 1, 720920, 0, 1, 720921, 0, 1, 720922, 0, 1, 720923, 0, 1, 720924, 0, 1, 720925, 0, 1, 720926, 0, 1, 720927, 0, 1, 720928, 0, 1, 720929, 0, 1, 720930, 0, 1, 720931, 0, 1, 720932, 0, 1, 720933, 0, 1, 720934, 0, 1, 720935, 0, 1, 720936, 0, 1, 720937, 0, 1, 720938, 0, 1, 720939, 0, 1, 720940, 0, 1, 720941, 0, 1, 720942, 0, 1, 720943, 0, 1, 720944, 0, 1, 720945, 0, 1, 720946, 0, 1, 720947, 0, 1, 720948, 0, 1, 720949, 0, 1, 720950, 0, 2, 720962, 0, 0, 720963, 0, 1, 720964, 0, 1, 720965, 0, 1, 720966, 0, 1, 720967, 0, 1, 720968, 0, 1, 720969, 0, 1, 720970, 0, 1, 720971, 0, 1, 720972, 0, 1, 720973, 0, 1, 720974, 0, 65537, 720975, 0, 65538, 851967, 0, 131072, 786432, 0, 131073, 786433, 0, 131073, 786434, 0, 131073, 786435, 0, 131073, 786436, 0, 131073, 786437, 0, 131073, 786438, 0, 131073, 786439, 0, 131073, 786440, 0, 131073, 786441, 0, 131073, 786442, 0, 131073, 786443, 0, 131073, 786444, 0, 196611, 786445, 0, 196611, 786446, 0, 65537, 786447, 0, 65537, 786448, 0, 196611, 786449, 0, 131073, 786450, 0, 131073, 786451, 0, 131073, 786452, 0, 131073, 786453, 0, 131073, 786454, 0, 131073, 786455, 0, 131073, 786456, 0, 131073, 786457, 0, 131073, 786458, 0, 131073, 786459, 0, 131073, 786460, 0, 131073, 786461, 0, 131073, 786462, 0, 131073, 786463, 0, 131073, 786464, 0, 131073, 786465, 0, 131073, 786466, 0, 131073, 786467, 0, 131073, 786468, 0, 131073, 786469, 0, 131073, 786470, 0, 131073, 786471, 0, 131073, 786472, 0, 131073, 786473, 0, 131073, 786474, 0, 131073, 786475, 0, 131073, 786476, 0, 131073, 786477, 0, 131073, 786478, 0, 131073, 786479, 0, 131073, 786480, 0, 131073, 786481, 0, 131073, 786482, 0, 131073, 786483, 0, 131073, 786484, 0, 131073, 786485, 0, 131073, 786486, 0, 131074, 786487, 2, 0, 786488, 2, 0, 786489, 2, 0, 786490, 2, 0, 786491, 2, 0, 786492, 2, 0, 786493, 2, 0, 786494, 2, 0, 786495, 2, 0, 786496, 2, 0, 786497, 2, 0, 786498, 0, 131072, 786499, 0, 131073, 786500, 0, 131073, 786501, 0, 131073, 786502, 0, 131073, 786503, 0, 131073, 786504, 0, 131073, 786505, 0, 131073, 786506, 0, 131073, 786507, 0, 131073, 786508, 0, 131073, 786509, 0, 131073, 786510, 0, 131073, 786511, 0, 131074, 851981, 0, 196611, 851982, 0, 131073, 851983, 0, 131073, 851984, 0, 131074 )

[node name="DebugDoor" parent="." instance=ExtResource( 3 )]
position = Vector2( 1200, 128 )
destination_level = "GrasslandTest2"

[node name="Lance" parent="." instance=ExtResource( 4 )]
position = Vector2( 15, 166 )

[node name="GUI" parent="." instance=ExtResource( 5 )]

[node name="AutoCameraBounds" type="Node" parent="."]
script = ExtResource( 6 )

[node name="ParallaxBackground" type="ParallaxBackground" parent="."]

[node name="ParallaxLayer" type="ParallaxLayer" parent="ParallaxBackground"]
motion_scale = Vector2( 0.2, 0 )

[node name="bg" type="Sprite" parent="ParallaxBackground/ParallaxLayer"]
position = Vector2( 147.75, 0 )
scale = Vector2( 2.79867, 1 )
texture = ExtResource( 7 )

[node name="Tilter" parent="." instance=ExtResource( 8 )]
position = Vector2( 352, 112 )

[node name="Tilter2" parent="." instance=ExtResource( 8 )]
position = Vector2( 328, 72 )
max_speed = Vector2( 150, 60 )
accel_magnitude = 70
follow_distance = 50
squirreliness_max = 2
texture = ExtResource( 9 )

[node name="Water" type="Area2D" parent="."]
position = Vector2( 880, 176 )
script = ExtResource( 10 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Water"]
position = Vector2( 88, 8 )
shape = SubResource( 1 )

[node name="ColorRect" type="ColorRect" parent="Water"]
material = SubResource( 3 )
margin_right = 176.0
margin_bottom = 16.0

[node name="Water2" type="Area2D" parent="."]
position = Vector2( 320, 144 )
script = ExtResource( 10 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="Water2"]
visible = false
position = Vector2( -104, -8 )
shape = SubResource( 4 )

[node name="ColorRect" type="ColorRect" parent="Water2"]
material = SubResource( 3 )
margin_left = -176.0
margin_top = -48.0
margin_right = -32.0
margin_bottom = 32.0

[connection signal="health_changed" from="Lance" to="GUI" method="_on_Lance_health_changed"]
[connection signal="body_entered" from="Water" to="Lance" method="_on_water_entered"]
[connection signal="body_exited" from="Water" to="Lance" method="_on_water_exited"]
[connection signal="body_entered" from="Water2" to="Lance" method="_on_water_entered"]
[connection signal="body_exited" from="Water2" to="Lance" method="_on_water_exited"]
